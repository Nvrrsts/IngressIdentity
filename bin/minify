#!/bin/bash

log() {
    echo "$@" >&2
}

set -e

cd $(dirname "$0")/..

destfile="$1"
sources=""
shift

log -n 'Minifying '

for i in "$@"; do
    log -n "js/$i.js "
    sources="$sources coffee/$i.coffee"
done

log "into build/js/$destfile.js"

# coffee -> js
# => disable logging by default
# => uglify
coffee --no-header -pc $sources \
    | sed -e 's/enableLogging = true/enableLogging = false/' \
    | uglifyjs - -o "build/js/$destfile.js" --screw-ie8 --mangle toplevel --compress --preamble "/**
 * This file is part of IngressIdentity
 *
 * @author Bram Gotink (@bgotink)
 * @license MIT
 * @url https://github.com/bgotink/IngressIdentity
 */"
